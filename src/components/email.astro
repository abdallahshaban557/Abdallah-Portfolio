<div id="email-container">
	<form id="email-form" action="send-email" method="post" class="w-full max-w-3xl">
		<div class="mb-4">
			<label for="send-email__from" class="mb-2 block text-sm font-bold text-black dark:text-white">
				From:
			</label>
			<input
				type="email"
				name="from"
				id="send-email__from"
				required
				class="w-full rounded-xl border-2 border-orange bg-white px-3 py-2 text-sm text-black focus:border-orange focus:outline-none focus:ring-2 focus:ring-orange dark:bg-black dark:text-white"
				placeholder="Your email address"
			/>
		</div>
		<div class="mb-4">
			<label
				for="send-email__subject"
				class="mb-2 block text-sm font-bold text-black dark:text-white"
			>
				Subject:
			</label>
			<input
				type="text"
				name="subject"
				id="send-email__subject"
				required
				class="w-full rounded-xl border-2 border-orange bg-white px-3 py-2 text-sm text-black focus:border-orange focus:outline-none focus:ring-2 focus:ring-orange dark:bg-black dark:text-white"
			/>
		</div>
		<div class="mb-4">
			<label
				for="send-email__message"
				class="mb-2 block text-sm font-bold text-black dark:text-white"
			>
				Message:
			</label>
			<textarea
				name="message"
				id="send-email__message"
				required
				rows="4"
				class="w-full rounded-xl border-2 border-orange bg-white px-3 py-2 text-sm text-black focus:border-orange focus:outline-none focus:ring-2 focus:ring-orange dark:bg-black dark:text-white"
			></textarea>
		</div>
		<div class="flex justify-center">
			<button
				type="submit"
				class="rounded-xl bg-orange px-4 py-2 text-sm font-bold text-white transition duration-300 hover:bg-black dark:hover:bg-white dark:hover:text-black"
			>
				Send message
			</button>
		</div>
	</form>
	<div id="loading-spinner" class="mt-4 hidden text-center">
		<div
			class="border-r-transparent inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-orange align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]"
			role="status"
		>
			<span
				class="!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"
				>Loading...</span
			>
		</div>
	</div>
</div>

<div class="mt-8 flex w-full justify-center">
	<div id="success-message" class="hidden w-full max-w-3xl text-center">
		<h2 class="mb-4 text-2xl font-bold text-orange">Thank you for your message!</h2>
		<p class="text-black dark:text-white">
			I have received your email and will get back to you as soon as possible.
		</p>
	</div>
</div>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const form = document.getElementById('email-form') as HTMLFormElement;
		const loadingSpinner = document.getElementById('loading-spinner');
		const successMessage = document.getElementById('success-message');
		const emailContainer = document.getElementById('email-container');

		if (form && loadingSpinner && successMessage && emailContainer) {
			form.addEventListener('submit', async (e) => {
				e.preventDefault();
				loadingSpinner.classList.remove('hidden');
				emailContainer.classList.add('opacity-50');

				const formData = new FormData(form);

				try {
					const response = await fetch('/actions/send-email', {
						method: 'POST',
						body: formData,
					});

					if (response.ok) {
						emailContainer.classList.add('hidden');
						successMessage.classList.remove('hidden');
					} else {
						console.error('Form submission failed');
						// Handle error (e.g., show an error message to the user)
					}
				} catch (error) {
					console.error('Error:', error);
					// Handle error (e.g., show an error message to the user)
				} finally {
					loadingSpinner.classList.add('hidden');
					emailContainer.classList.remove('opacity-50');
				}
			});
		}
	});
</script>
